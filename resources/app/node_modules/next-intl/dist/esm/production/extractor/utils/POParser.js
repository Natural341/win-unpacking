class t{static KEYWORDS={MSGID:"msgid",MSGSTR:"msgstr",MSGCTXT:"msgctxt",MSGID_PLURAL:"msgid_plural"};static COMMENTS={REFERENCE:"#:",EXTRACTED:"#.",TRANSLATOR:"#",FLAG:"#,",PREVIOUS:"#|"};static NAMESPACE_SEPARATOR=".";static QUOTE='"';static NEWLINE="\\n";static FILE_COLUMN_SEPARATOR=":";static META_SEPARATOR=":";static parse(e){const s=t.splitLines(e),i=[],r={};let n,E="entry";for(let e=0;e<s.length;e++){const a=s[e].trim();if(a)if("meta"===E)if(a.startsWith(t.QUOTE)){const e=t.extractQuotedString(a,E),s=e.endsWith(t.NEWLINE)?e.slice(0,-2):e,i=s.indexOf(t.META_SEPARATOR);if(i>0){const t=s.substring(0,i).trim(),e=s.substring(i+1).trim();r[t]=e}}else t.throwWithLine("Encountered unexpected non-quoted metadata line",a);else{if(t.lineStartsWithPrefix(a,t.COMMENTS.TRANSLATOR)&&t.throwWithLine("Translator comments (#) are not supported, use inline descriptions instead",a),t.lineStartsWithPrefix(a,t.COMMENTS.FLAG)&&t.throwWithLine("Flag comments (#,) are not supported",a),t.lineStartsWithPrefix(a,t.COMMENTS.PREVIOUS)&&t.throwWithLine("Previous string key comments (#|) are not supported",a),t.lineStartsWithPrefix(a,t.COMMENTS.REFERENCE)){n=t.ensureEntry(n);const e=a.substring(t.COMMENTS.REFERENCE.length).trim().split(t.FILE_COLUMN_SEPARATOR).at(0);n.references??=[],n.references.push({path:e});continue}if(t.lineStartsWithPrefix(a,t.COMMENTS.EXTRACTED)){n=t.ensureEntry(n),n.description=a.substring(t.COMMENTS.EXTRACTED.length).trim();continue}if(t.lineStartsWithPrefix(a,t.KEYWORDS.MSGID_PLURAL)&&t.throwWithLine("Plural forms (msgid_plural) are not supported, use ICU pluralization instead",a),t.lineStartsWithPrefix(a,t.KEYWORDS.MSGCTXT)){n=t.ensureEntry(n),n.msgctxt=t.extractQuotedString(a.substring(t.KEYWORDS.MSGCTXT.length+1),E);continue}if(t.lineStartsWithPrefix(a,t.KEYWORDS.MSGID)){n=t.ensureEntry(n),n.msgid=t.extractQuotedString(a.substring(t.KEYWORDS.MSGID.length+1),E),t.isMetaEntry(n,i)&&(E="meta",n=void 0);continue}if(t.lineStartsWithPrefix(a,t.KEYWORDS.MSGSTR)){n=t.ensureEntry(n),n.msgstr=t.extractQuotedString(a.substring(t.KEYWORDS.MSGSTR.length+1),E),t.isMetaEntry(n,i)&&(E="meta",n=void 0);continue}a.startsWith(t.QUOTE)&&t.throwWithLine("Multi-line strings are not supported, use single-line strings instead",a)}else"entry"===E&&n&&(i.push(t.finishEntry(n)),n=void 0),E="entry"}return"entry"===E&&n&&i.push(t.finishEntry(n)),{meta:Object.keys(r).length>0?r:void 0,messages:i.length>0?i:void 0}}static isMetaEntry(t,e){return 0===e.length&&""===t.msgid&&""===t.msgstr}static serialize(e){const s=[];if(e.meta){s.push(`${t.KEYWORDS.MSGID} ${t.QUOTE}${t.QUOTE}`),s.push(`${t.KEYWORDS.MSGSTR} ${t.QUOTE}${t.QUOTE}`);for(const[i,r]of Object.entries(e.meta))s.push(`${t.QUOTE}${i}${t.META_SEPARATOR} ${r}${t.NEWLINE}${t.QUOTE}`);s.push("")}if(e.messages)for(const i of e.messages){if(i.description&&s.push(`${t.COMMENTS.EXTRACTED} ${i.description}`),i.references&&i.references.length>0)for(const e of i.references)s.push(`${t.COMMENTS.REFERENCE} ${e.path}`);let e,r;const n=i.id.lastIndexOf(t.NAMESPACE_SEPARATOR);n>0?(e=i.id.substring(0,n),r=i.id.substring(n+1)):r=i.id,e&&s.push(`${t.KEYWORDS.MSGCTXT} ${t.QUOTE}${e}${t.QUOTE}`),s.push(`${t.KEYWORDS.MSGID} ${t.QUOTE}${r}${t.QUOTE}`),s.push(`${t.KEYWORDS.MSGSTR} ${t.QUOTE}${i.message}${t.QUOTE}`),s.push("")}return s.join("\n")}static lineStartsWithPrefix(t,e){return t.startsWith(e+" ")}static throwWithLine(t,e){throw new Error(`${t}:\n> ${e}`)}static splitLines(t){return t.includes("\r")&&(t=t.replace(/\r\n/g,"\n")),t.split("\n")}static ensureEntry(t){return t||{}}static finishEntry(e){if(null==e.msgid||null==e.msgstr)throw new Error("Incomplete message entry: both msgid and msgstr are required");let s=e.msgid;return e.msgctxt&&(s=e.msgctxt+t.NAMESPACE_SEPARATOR+e.msgid),{id:s,message:e.msgstr,description:e.description,references:e.references}}static extractQuotedString(e,s){const i=e.trim(),r=i.indexOf(t.QUOTE,t.QUOTE.length);if(-1===r){if("meta"===s)return i.substring(t.QUOTE.length);t.throwWithLine("Incomplete quoted string",e)}return i.substring(t.QUOTE.length,r)}}export{t as default};
