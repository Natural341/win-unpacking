module.exports=[28101,a=>{"use strict";var b=a.i(73151);let c=b.forwardRef(function({title:a,titleId:c,...d},e){return b.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":c},d),a?b.createElement("title",{id:c},a):null,b.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))});a.s(["MagnifyingGlassIcon",0,c],28101)},81260,2686,66452,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInWeek",0,6048e5],2686),a.s(["constructFrom",()=>c],66452),a.s(["toDate",()=>d],81260)},53552,a=>{"use strict";var b=a.i(19598),c=a.i(73151),d=a.i(28101);let e=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});var f=a.i(35645);function g(){let[a,g]=(0,c.useState)(""),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)({}),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(1),[v,w]=(0,c.useState)(1);(0,c.useEffect)(()=>{x()},[t,p,r]);let x=async()=>{m(!0);try{let a=`/api/sales?page=${t}&limit=10`;p&&(a+=`&startDate=${p}`),r&&(a+=`&endDate=${r}`);let b=await fetch(a);if(b.ok){let a=await b.json();i(a.sales||a),a.pagination&&w(a.pagination.totalPages||1)}}catch(a){console.error("Error fetching sales:",a)}finally{m(!1)}},y=async()=>{if(a){m(!0);try{let b=await fetch(`/api/sales?search=${a}`);if(b.ok){let a=await b.json();i(a.sales||a),u(1)}}catch(a){console.error("Error searching sales:",a)}finally{m(!1)}}},z=()=>{if(!j)return 0;let a=0;return j.items.forEach(b=>{let c=n[b.id]||0;a+=c*b.unitPrice}),a},A=async()=>{if(!j)return;let a=j.items.filter(a=>(n[a.id]||0)>0).map(a=>({productId:a.product.id,quantity:n[a.id],unitPrice:a.unitPrice}));if(0===a.length)return void console.warn("İade edilecek ürün seçilmedi");m(!0);try{let b=await fetch("/api/returns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({saleId:j.id,items:a})});if(b.ok)await b.json(),k(null),i([]),g("");else{let a=await b.json();console.error("❌ İade Hatası:",a.error)}}catch(a){console.error("❌ İade İşlemi Hatası:",a)}finally{m(!1)}};return(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold text-gray-950 mb-8 tracking-tight",children:"İade İşlemleri"}),(0,b.jsxs)("div",{className:"bg-white shadow-sm rounded-xl p-7 border border-gray-100 mb-7",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-950 mb-5 tracking-tight",children:"Satış Ara"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Başlangıç Tarihi"}),(0,b.jsx)("input",{type:"date",value:p,onChange:a=>{q(a.target.value),u(1)},className:"w-full rounded-lg border-gray-300 focus:border-gray-900 focus:ring-gray-900 py-2 px-3 border font-medium"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Bitiş Tarihi"}),(0,b.jsx)("input",{type:"date",value:r,onChange:a=>{s(a.target.value),u(1)},className:"w-full rounded-lg border-gray-300 focus:border-gray-900 focus:ring-gray-900 py-2 px-3 border font-medium"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4",children:(0,b.jsx)(d.MagnifyingGlassIcon,{className:"h-5 w-5 text-gray-400"})}),(0,b.jsx)("input",{type:"text",placeholder:"Satış numarası ile ara...",value:a,onChange:a=>g(a.target.value),onKeyPress:a=>"Enter"===a.key&&y(),className:"block w-full rounded-lg border-gray-300 pl-12 focus:border-gray-900 focus:ring-gray-900 py-3 px-4 border shadow-sm font-medium tracking-tight"})]}),(0,b.jsx)("button",{onClick:y,disabled:l,className:"px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 font-bold shadow-sm hover:shadow-md transition-all duration-150 disabled:opacity-50 tracking-tight",children:"Ara"})]}),h.length>0&&!j&&(0,b.jsxs)("div",{className:"mt-5 space-y-2",children:[h.map(a=>(0,b.jsxs)("div",{onClick:()=>{let b;return k(a),b={},void(a.items.forEach(a=>{b[a.id]=0}),o(b))},className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 cursor-pointer transition-all duration-150",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-gray-950 tracking-tight",children:a.saleNumber}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-0.5 font-medium",children:[(0,f.format)(new Date(a.createdAt),"dd/MM/yyyy HH:mm")," • ",a.items.length," ürün"]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"font-bold text-gray-950 tracking-tight",children:["₺",a.finalAmount.toFixed(2)]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-0.5 font-semibold uppercase",children:a.paymentMethod})]})]},a.id)),v>1&&(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-6",children:[(0,b.jsx)("button",{onClick:()=>u(Math.max(1,t-1)),disabled:1===t,className:"px-4 py-2 border-2 border-gray-300 rounded-lg font-semibold text-gray-700 hover:border-black hover:text-black disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Önceki"}),(0,b.jsx)("div",{className:"flex gap-2",children:Array.from({length:Math.min(5,v)},(a,c)=>{let d;return d=v<=5||t<=3?c+1:t>=v-2?v-4+c:t-2+c,(0,b.jsx)("button",{onClick:()=>u(d),className:`px-4 py-2 rounded-lg font-bold transition-all ${t===d?"bg-black text-white":"border-2 border-gray-300 text-gray-700 hover:border-black hover:text-black"}`,children:d},d)})}),(0,b.jsx)("button",{onClick:()=>u(Math.min(v,t+1)),disabled:t===v,className:"px-4 py-2 border-2 border-gray-300 rounded-lg font-semibold text-gray-700 hover:border-black hover:text-black disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Sonraki"})]})]})]}),j&&(0,b.jsxs)("div",{className:"bg-white shadow-sm rounded-xl p-7 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold text-gray-950 tracking-tight",children:["İade Detayları - ",j.saleNumber]}),(0,b.jsx)("button",{onClick:()=>k(null),className:"text-gray-600 hover:text-gray-900 font-semibold",children:"İptal"})]}),(0,b.jsx)("div",{className:"space-y-3 mb-6",children:j.items.map(a=>{let c=((a,b,c)=>{if(!a.returns)return c;let d=0;return a.returns.forEach(a=>{a.items.forEach(a=>{a.productId===b&&(d+=a.quantity)})}),Math.max(0,c-d)})(j,a.product.id,a.quantity),d=a.quantity-c;return(0,b.jsxs)("div",{className:`flex items-center justify-between p-4 border rounded-lg ${0===c?"border-gray-200 bg-gray-50 opacity-60":"border-gray-200"}`,children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-950 tracking-tight",children:a.product.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-0.5 font-medium",children:[a.product.barcode," • ₺",a.unitPrice.toFixed(2)," × ",a.quantity]}),d>0&&(0,b.jsxs)("p",{className:"text-xs text-orange-600 mt-1 font-semibold",children:[d," adet daha önce iade edildi"]})]}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:c>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("label",{className:"text-sm font-bold text-gray-700 tracking-tight",children:"İade Adedi:"}),(0,b.jsx)("input",{type:"number",min:"0",max:c,value:n[a.id]||0,onChange:b=>{var d,e;return d=a.id,e=parseInt(b.target.value)||0,void o({...n,[d]:Math.max(0,Math.min(e,c))})},className:"w-20 rounded-lg border-gray-300 shadow-sm focus:border-gray-900 focus:ring-gray-900 py-2 px-3 border font-semibold tracking-tight text-center"}),(0,b.jsxs)("span",{className:"text-sm text-gray-600 font-medium",children:["/ ",c]})]}):(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-500",children:"Tam iade edildi"})})]},a.id)})}),(0,b.jsxs)("div",{className:"border-t-2 border-gray-300 pt-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-lg font-bold text-gray-950 tracking-tight",children:"İade Tutarı:"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-gray-950 tracking-tight",children:["₺",z().toFixed(2)]})]}),(0,b.jsxs)("button",{onClick:A,disabled:l||0===z(),className:"w-full px-6 py-4 bg-black text-white rounded-lg hover:bg-gray-800 font-bold shadow-sm hover:shadow-md transition-all duration-150 disabled:opacity-50 tracking-tight flex items-center justify-center gap-3",children:[(0,b.jsx)(e,{className:"h-6 w-6"}),l?"İşleniyor...":"İade İşlemini Tamamla"]})]})]})]})}a.s(["default",()=>g],53552)}];

//# sourceMappingURL=Downloads_dark-1_barkod_a668edb8._.js.map