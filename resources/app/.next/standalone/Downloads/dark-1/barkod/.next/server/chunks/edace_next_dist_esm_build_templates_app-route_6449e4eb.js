module.exports=[76756,e=>{"use strict";var t=e.i(38492),r=e.i(84872),a=e.i(70799),i=e.i(30338),n=e.i(81164),o=e.i(71848),s=e.i(7940),d=e.i(97514),l=e.i(63734),u=e.i(82872),c=e.i(62363),p=e.i(49641),m=e.i(29642),f=e.i(52927),h=e.i(39125),g=e.i(34218),y=e.i(93695);e.i(21457);var w=e.i(19079),k=e.i(31338),x=e.i(48221),v=e.i(16951);async function R(e){try{let t,r=await e.formData(),a=r.get("file"),i=r.get("type"),n="true"===r.get("updateExisting");if(!a)return k.NextResponse.json({success:!1,error:"No file uploaded"},{status:400});if(!i)return k.NextResponse.json({success:!1,error:"Import type is required (products, customers, suppliers)"},{status:400});let o=await a.arrayBuffer(),s=Buffer.from(o),d=v.read(s,{type:"buffer"}),l=d.SheetNames[0],u=d.Sheets[l],c=v.utils.sheet_to_json(u,{defval:""});if(0===c.length)return k.NextResponse.json({success:!1,error:"File is empty or invalid"},{status:400});switch(i){case"products":t=await S(c,n);break;case"customers":t=await b(c,n);break;case"suppliers":t=await C(c,n);break;default:return k.NextResponse.json({success:!1,error:"Invalid import type"},{status:400})}return k.NextResponse.json(t)}catch(e){return console.error("Error importing data:",e),k.NextResponse.json({success:!1,error:"Import failed",message:e.message},{status:500})}}async function S(e,t){let r={success:!0,imported:0,failed:0,errors:[],summary:{created:0,updated:0,skipped:0}},a={barcode:["barkod","barcode","ean","ean13"],name:["ürün adı","urun adi","name","product name","ad","isim"],description:["açıklama","aciklama","description","desc"],category:["kategori","category"],supplier:["tedarikçi","tedarikci","supplier"],price:["satış fiyatı","satis fiyati","price","sale price","fiyat"],costPrice:["alış fiyatı","alis fiyati","cost price","cost","maliyet"],stock:["stok","stock","quantity","miktar"],minStock:["min stok","minimum stock","minstock"],maxStock:["max stok","maximum stock","maxstock"],unit:["birim","unit"],shelfLocation:["raf","raf konumu","shelf","location"],taxRate:["kdv","kdv oranı","tax rate","tax","vergi"]};for(let i=0;i<e.length;i++){let n=e[i],o=i+2;try{let e={},i=Object.keys(n);for(let[t,r]of Object.entries(a))for(let a of r){let r=i.find(e=>e.toLowerCase().trim()===a.toLowerCase());if(r&&n[r]){e[t]=n[r];break}}if(!e.barcode||!e.name){r.errors.push({row:o,error:"Barcode and name are required",data:n}),r.failed++;continue}let s=String(e.barcode).trim(),d=String(e.name).trim(),l=parseFloat(String(e.price||0)),u=parseFloat(String(e.costPrice||0)),c=parseFloat(String(e.stock||0)),p=parseFloat(String(e.minStock||0)),m=e.maxStock?parseFloat(String(e.maxStock)):null,f=parseFloat(String(e.taxRate||18));if(isNaN(l)||l<0){r.errors.push({row:o,error:"Invalid price",data:n}),r.failed++;continue}let h=await x.prisma.product.findUnique({where:{barcode:s}});if(h&&!t){r.summary.skipped++;continue}let g=null;if(e.category){let t=String(e.category).trim(),r=await x.prisma.category.findFirst({where:{name:t}});r||(r=await x.prisma.category.create({data:{name:t}})),g=r.id}let y=null;if(e.supplier){let t=String(e.supplier).trim(),r=await x.prisma.supplier.findFirst({where:{name:t}});r&&(y=r.id)}let w={barcode:s,name:d,description:e.description?String(e.description).trim():null,categoryId:g,supplierId:y,price:l,costPrice:u,stock:c,minStock:p,maxStock:m,unit:e.unit?String(e.unit).trim():"adet",shelfLocation:e.shelfLocation?String(e.shelfLocation).trim():null,taxRate:f};if(h){let e=h.stock;await x.prisma.product.update({where:{id:h.id},data:w}),c!==e&&await x.prisma.stockMovement.create({data:{productId:h.id,type:c>e?"in":"out",quantity:Math.abs(c-e),previousStock:e,newStock:c,referenceType:"import",reason:"Excel/CSV import ile stok güncellendi"}}),r.summary.updated++}else{let e=await x.prisma.product.create({data:w});c>0&&await x.prisma.stockMovement.create({data:{productId:e.id,type:"in",quantity:c,previousStock:0,newStock:c,referenceType:"import",reason:"Excel/CSV import ile ilk stok girişi"}}),r.summary.created++}r.imported++}catch(e){r.errors.push({row:o,error:e.message,data:n}),r.failed++}}return r.success=r.failed<e.length,r}async function b(e,t){let r={success:!0,imported:0,failed:0,errors:[],summary:{created:0,updated:0,skipped:0}},a={code:["müşteri kodu","musteri kodu","code","customer code","kod"],name:["müşteri adı","musteri adi","name","customer name","ad","isim"],email:["e-posta","email","e-mail"],phone:["telefon","phone","tel"],address:["adres","address"],taxNumber:["vergi no","tax number","vergi numarası"],taxOffice:["vergi dairesi","tax office"],customerType:["müşteri tipi","musteri tipi","customer type","type","tip"],creditLimit:["kredi limiti","credit limit","limit"],discount:["indirim","discount","indirim oranı"]};for(let i=0;i<e.length;i++){let n=e[i],o=i+2;try{let e={},i=Object.keys(n);for(let[t,r]of Object.entries(a))for(let a of r){let r=i.find(e=>e.toLowerCase().trim()===a.toLowerCase());if(r&&n[r]){e[t]=n[r];break}}if(!e.code||!e.name){r.errors.push({row:o,error:"Code and name are required",data:n}),r.failed++;continue}let s=String(e.code).trim(),d=String(e.name).trim(),l=await x.prisma.customer.findUnique({where:{code:s}});if(l&&!t){r.summary.skipped++;continue}let u={code:s,name:d,email:e.email?String(e.email).trim():null,phone:e.phone?String(e.phone).trim():null,address:e.address?String(e.address).trim():null,taxNumber:e.taxNumber?String(e.taxNumber).trim():null,taxOffice:e.taxOffice?String(e.taxOffice).trim():null,customerType:e.customerType?String(e.customerType).toLowerCase():"retail",creditLimit:e.creditLimit?parseFloat(String(e.creditLimit)):0,discount:e.discount?parseFloat(String(e.discount)):0};l?(await x.prisma.customer.update({where:{id:l.id},data:u}),r.summary.updated++):(await x.prisma.customer.create({data:u}),r.summary.created++),r.imported++}catch(e){r.errors.push({row:o,error:e.message,data:n}),r.failed++}}return r.success=r.failed<e.length,r}async function C(e,t){let r={success:!0,imported:0,failed:0,errors:[],summary:{created:0,updated:0,skipped:0}},a={code:["tedarikçi kodu","tedarikci kodu","code","supplier code","kod"],name:["tedarikçi adı","tedarikci adi","name","supplier name","ad","isim"],contactPerson:["iletişim kişisi","iletisim kisisi","contact person","contact"],email:["e-posta","email","e-mail"],phone:["telefon","phone","tel"],address:["adres","address"],taxNumber:["vergi no","tax number","vergi numarası"],taxOffice:["vergi dairesi","tax office"],paymentTerm:["ödeme vadesi","odeme vadesi","payment term","vade"]};for(let i=0;i<e.length;i++){let n=e[i],o=i+2;try{let e={},i=Object.keys(n);for(let[t,r]of Object.entries(a))for(let a of r){let r=i.find(e=>e.toLowerCase().trim()===a.toLowerCase());if(r&&n[r]){e[t]=n[r];break}}if(!e.code||!e.name){r.errors.push({row:o,error:"Code and name are required",data:n}),r.failed++;continue}let s=String(e.code).trim(),d=String(e.name).trim(),l=await x.prisma.supplier.findUnique({where:{code:s}});if(l&&!t){r.summary.skipped++;continue}let u={code:s,name:d,contactPerson:e.contactPerson?String(e.contactPerson).trim():null,email:e.email?String(e.email).trim():null,phone:e.phone?String(e.phone).trim():null,address:e.address?String(e.address).trim():null,taxNumber:e.taxNumber?String(e.taxNumber).trim():null,taxOffice:e.taxOffice?String(e.taxOffice).trim():null,paymentTerm:e.paymentTerm?parseInt(String(e.paymentTerm)):0};l?(await x.prisma.supplier.update({where:{id:l.id},data:u}),r.summary.updated++):(await x.prisma.supplier.create({data:u}),r.summary.created++),r.imported++}catch(e){r.errors.push({row:o,error:e.message,data:n}),r.failed++}}return r.success=r.failed<e.length,r}e.s(["POST",()=>R],97385);var E=e.i(97385);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/import/route",pathname:"/api/import",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Downloads/dark-1/barkod/app/api/import/route.ts",nextConfigOutput:"standalone",userland:E}),{workAsyncStorage:O,workUnitAsyncStorage:T,serverHooks:P}=N;function A(){return(0,a.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:T})}async function q(e,t,a){N.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let k="/api/import/route";k=k.replace(/\/index$/,"")||"/";let x=await N.prepare(e,t,{srcPage:k,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:S,parsedUrl:b,isDraftMode:C,prerenderManifest:E,routerServerContext:O,isOnDemandRevalidate:T,revalidateOnlyGenerated:P,resolvedPathname:A,clientReferenceManifest:q,serverActionsManifest:I}=x,_=(0,d.normalizeAppPath)(k),j=!!(E.dynamicRoutes[_]||E.routes[A]),L=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,b,!1):t.end("This page could not be found"),null);if(j&&!C){let e=!!E.routes[A],t=E.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await L();throw new y.NoFallbackError}}let F=null;!j||N.isDev||C||(F="/index"===(F=A)?"/":F);let M=!0===N.isDev||!j,U=j&&!M;I&&q&&(0,o.setReferenceManifestsSingleton)({page:k,clientReferenceManifest:q,serverActionsManifest:I,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:I})});let H=e.method||"GET",D=(0,n.getTracer)(),$=D.getActiveScopeSpan(),B={params:R,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>N.onRequestError(e,t,a,O)},sharedContext:{buildId:v}},K=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let o=async e=>N.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=D.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${k}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var n,d;let l=async({previousCacheEntry:r})=>{try{if(!s&&T&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let d=B.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=B.renderOpts.collectedTags;if(!j)return await (0,m.sendResponse)(K,V,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[g.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},O),t}},u=await N.handleResponse({req:e,nextConfig:S,cacheKey:F,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:s});if(!j)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&j||c.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(K,V,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await d($):await D.withPropagatedContext(e.headers,()=>D.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${k}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof y.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})}),j)throw t;return await (0,m.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>A,"routeModule",()=>N,"serverHooks",()=>P,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>T],76756)}];

//# sourceMappingURL=edace_next_dist_esm_build_templates_app-route_6449e4eb.js.map